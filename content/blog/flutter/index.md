---
title: Flutter
date: "2021-1-25"
description: "Flutter公式の翻訳"
tags: ["Flutter", "dart"]
---

Flutter の勉強をしています。
公式チュートリアル の翻訳してみました。

Docs> Development > Data &backend > state management> Differentiate between ephemeral state and app state

### 一時的な状態とアプリの状態を区別する。

- コンテンツ
  - 一時的な状態
  - アプリの状態
  - 明確なルールがない場合

このドキュメントでは、アプリの状態、一時的な状態そして、Flutter でそれらを管理する方法を紹介します。

言ってしまえば、アプリの状態とは、そのアプリが稼働中にメモリーに存在している全てです。これは、Flutter が その
UI やアニメーション、状態、文字、フォント等々について、保持しているアプリのアセットやすべての変数を含めます。  
この状態の定義は、有効である一方、アプリの設計においては、あまり有用ではありません。

まず、テクスチャのような一部の状態などは、管理できません。それはフレームワークが処理します。したがって、状態のより有用な定義は、「いつでも UI を再構築するために必要なデータ」です。次に、自分で管理している状態は、一時的な状態とアプリの状態の二つのタイプに区分することができます。

- 一時的な状態

一時的な状態は、一つの Widget にぴったりと含まれる状態（UI の状態や local な状態と呼ばれます）のことを言います。  
 これは、意図して漠然な定義です。なので、いくつか例示します。

- 現在のページのページビュー
- 複雑な動きのなかの現在の状態
- フッターのナビゲーションバーの選択中のタブ

Widget ツリーの他の箇所は、この手の状態には、めったにアクセスする必要がありません。それを初期化する必要もなく、そして複雑な方法で変化しません。
言い換えれば、この手の状態については、状態管理のテクニックを使う必要がありません。必要なのは StatefulWidget のみです。

以下は、\_MyHomepageState class の\_index フィールドの中でボトムナビゲーションバーの現在選択された項目がどうなっているかを理解できます。
この例示は、一時的な状態です。

```dart
class MyHomepage extends StatefulWidget {
@override
  _MyHomepageState createState() => _MyHomepageState();
}

class _MyHomepageState extends State<MyHomepage> {
int _index = 0;

@override
Widget build(BuildContext context) {
return BottomNavigationBar(
currentIndex: _index,
onTap: (newIndex) {
setState(() {
  _index = newIndex;
});
},
// ... items ...
);
}
}
```

この例示では、 StatefulWidget’s State class の中で、setState()を使用することが、自然です。アプリ内の他の箇所では\_index にアクセスする必要がありません。その変数は、MyHomepage Widget の中でのみ変化します。 そして、もし、アプリが閉じられたり、リスタートした場合、\_index がリセットされてゼロになっても、構わないのです。

### アプリの状態。

一時的な状態ではない、アプリ内の様々な場面でシェアしたい状態、ユーザーセッションを保持したい状態、私たちがアプリの状態と呼んでいるものは、このような状態です。（時々、shared state とも呼ばれます。）
例えば、

- ユーザー設定
- ログイン情報
- SNS 通知
- E コマースのショッピングカート
- ニュースアプリの既読、未読の状態

アプリの状態を管理するため、アプリを取り巻く様々な条件を調査する必要があります。その選択は、アプリ本体の性質や複雑さ、制作チームの経験やその他多くのものに依存します。

### 明確なルールがない場合

はっきり言って、State と setState() を使ってアプリ内のすべてのステートを管理することができます。実際、Flutter チームは多くのシンプルなアプリサンプル（flutter create のたびに提供されるスターターアプリを含む）でこれを行っています。  
これは逆の場合もあります。たとえば、特定のアプリのコンテキストでは、下のナビゲーションバーで選択されたタブは一時的な状態ではないと判断するかもしれません。この状態をクラスの外から変更したり、セッション間で保持したりする必要があるかもしれません。この場合、\_index 変数はアプリの状態を表します。

特定の変数が一時的な状態なのかアプリの状態なのかを区別するための明確な普遍的なルールはありません。時には、どちらかを別のものにリファクタリングしなければならないこともあります。例えば、最初は明らかに一時的な状態で始めたが、アプリケーションの機能が大きくなってくると、アプリの状態に移動する必要があるかもしれません。

そんなことで、やさしさをもって、下の図を参照してください。
![ephemeral-vs-app-state-3137024aa509b4df5d20ed7ed30fb8a0f7cff54ebc8ab0d6e39794bced87e27c](https://user-images.githubusercontent.com/50585862/105812237-21937100-5ff1-11eb-8bb8-2329caeadf2b.png)

React の setState と Redux のストアについて質問されると、Redux の作者である Dan Abramov 氏はこう答えています。  
経験則は 何でもいいから気まずくないことをしなさい。

要約すると、Flutter アプリには 2 つの概念的なタイプのステートがあります。一時的な状態は、State と setState() を使用して実装でき、多くの場合、単一の Widget にローカルに存在します。それ以外はアプリの状態です。この 2 つのタイプは Flutter アプリの中で適切な役割を果たしますが、どちらを選ぶかは、自分の好みとアプリの複雑さによります。
